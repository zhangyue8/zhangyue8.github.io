<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Let's load some data!</title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <style>
            body{
                margin:0;
            }
        
        
        
        </style>
    </head>
    <body>
        Hello
        <svg id="chart"></svg>









            <script>
                var realtimeURL = "https://whiteboard.datawheel.us/api/google-analytics/realtime/random";
                var frequency = 1 * 1000; 


                var dataMax = 5;
                var data = [];

                var width=window.innerWidth;
                var height=window.innerHeight;
                var svg= d3.select("#chart")
                    .attr("width",width)
                    .attr("height",height);



                var barWidth = width / dataMax;



                var x = d3.scaleLinear()
                .domain([dataMax, 1])
                .range([0, width]);





                function fetchData() {

                d3.json(realtimeURL, function(error, users) {



                    var dataObject={
                        users: users,
                        timestamp: new Date() //括号里可以改时间戳
                    };




                    data.unshift(users);
                    if (data.length > dataMax) data.pop();
                    console.log(data);

                    var maximum=d3.max(data, function(d){
                        return d.users;
                    });


                    var barHeight = d3.scaleLinear()
                    .domain([0, d3.max(data)])
                    .range([0, height]);


                    var bars = svg.selectAll(".bar")
                        .data(data, function(d){
                            return d.timestamp;
                        });

                    var enter=bars.enter().append("rect")
                    .attr("class", "bar")
                    .attr("width", barWidth)
                    .attr("height", 0)
                    .attr("y",height)
                    .attr("x", function(d, i) {
                        return x(i + 1);
                    });


                    bars.merge(enter)
                    .transition().duration(frequency / 2)
                    .attr("x", function(d, i) {
                        return x(i + 1);
                    })
                    .attr("height", barHeight)
                    .attr("y", function(d, i) {
                        var h = barHeight(d.users);
                        return height - h;
                    });











                    bars.exit().remove();

                });
                }
            


            
            
                fetchData();
                setInterval(fetchData, frequency);
            </script>        
        
    </body>
</html>